<div class="container1">
    <div class="container mt-5">
      <h2 style="color: #0b5da7" class="text-center fw-bold">ĐẶT TOUR</h2>
      <img src="assets/image/nhapthongtin.jpg" class="img-fluid" alt="" />
  
      <!-- Thông tin liên lạc -->
      <div class="row mt-4">
        <div class="col-lg-7" id="leftCol">
          <div class="fw-bold">THÔNG TIN LIÊN LẠC</div>
          <form [formGroup]="contactForm" class="row mt-2">
            <div class="col-lg-6 d-flex flex-column border-end">
              <label class="fw-bold">Họ tên <span class="text-danger">*</span></label>
              <input formControlName="name" type="text" class="w-100" placeholder="Liên hệ" />
            </div>
            <div class="col-lg-6 d-flex flex-column">
              <label class="fw-bold">Điện thoại <span class="text-danger">*</span></label>
              <input formControlName="phone" type="text" class="w-100" placeholder="Nhập số điện thoại" />
            </div>
            <div class="col-lg-6 d-flex flex-column border-end mt-3">
              <label class="fw-bold">Email </label>
              <input formControlName="email" type="email" class="w-100" placeholder="Nhập email" />
            </div>
            <div class="col-lg-6 d-flex flex-column mt-3">
              <label class="fw-bold">Địa chỉ </label>
              <input formControlName="address" type="text" class="w-100" placeholder="Nhập địa chỉ" />
            </div>
          </form>
  
          <!-- Hành khách -->
          <div class="fw-bold mt-4">HÀNH KHÁCH</div>
          <div class="row mt-1 g-3 gx-2">
            <ng-container *ngFor="let group of ageGroups">
              <div class="col-lg-6">
                <div class="h-100 d-flex border rounded p-3 w-100">
                  <div class="d-flex flex-column gap-2 w-50">
                    <div class="fw-medium">{{ group.header }}</div>
                    <div style="font-size: 0.8rem">
                      {{ group.describe }} <i class="ri-information-2-fill"></i>
                    </div>
                  </div>
                  <div class="quantity-wrapper d-flex justify-content-between align-items-center w-50 fw-semibold">
                    <button class="fs-3 decrease px-3 pb-1 text-center" (click)="decrease(group.key)">-</button>
                    <div class="quantity">{{ group.count }}</div>
                    <button class="fs-3 increase px-3 pb-1 text-center" (click)="increase(group.key)">+</button>
                  </div>
                </div>
              </div>
            </ng-container>
          </div>
  
          <!-- Thông tin hành khách -->
            <div class="fw-bold mt-4">THÔNG TIN HÀNH KHÁCH</div>
            <div class="row mt-3 g-4"> 
            <ng-container *ngFor="let group of ageGroups">
            <ng-container *ngFor="let info of passengers[group.key]; let i = index">
              <div class="col-lg-12">
                <div class="border-top border-secondary-subtle pt-2">
                  <strong>{{ group.header }}</strong> <i>({{ group.describe }})</i>
                </div>
                <div class="d-flex w-100 mt-2">
                  <div class="d-flex flex-column border-end p-2" style="width: 33.33%">
                    <div><strong>Họ tên</strong> </div>
                    <input [(ngModel)]="info.fullName" class="cb-hk" />
                  </div>
                  <div class="d-flex flex-column border-end p-2" style="width: 33.33%">
                    <div><strong>Giới tính</strong></div>
                    <select [(ngModel)]="info.gender" class="sl-custom">
                      <option value="NAM">Nam</option>
                      <option value="Nu">Nữ</option>
                    </select>
                  </div>
                    <div class="d-flex flex-column p-2" style="width: 33.33%">
                    <div><strong>Ngày sinh</strong></div>
                    <input [(ngModel)]="info.dob" type="date" class="dob-input" />
                    </div>
                </div>
              </div>
            </ng-container>
          </ng-container>

          </div>
         <!-- Ghi chú -->
            <textarea [(ngModel)]="message" class="w-100 rounded bg-body-tertiary p-3 mt-3" style="height: 80px" placeholder="Nhập vào lời nhắn"></textarea>
        </div>
  
        <!-- Tóm tắt chuyến đi -->
        <div class="col-lg-5">
          <div id="rightCol">
            <h6 class="mb-3 fw-bold">TÓM TẮT CHUYẾN ĐI</h6>
            <div class="summary-box bg-light">
              <div class="d-flex" style="height: 150px">
                <div style="width: 40%" class="pe-2">
                  <img
                    src="assets/image/langNghe - Copy.jpg"
                    class="img-fluid rounded mb-3 h-100 w-100"
                    alt="Tour"
                  />
                </div>
                <div style="width: 60%" class="d-flex flex-column justify-content-between">
                  <div >
                    <h5>{{stateData?.tourName}}</h5> 
                  </div>
                  <div class="d-flex">
                    <img src="assets/image/ticket.jpg" alt="" style="width: 20px; height: 20px" />
                    <p class="maTour">Mã tour : {{stateData?.tourCode}}</p>
                  </div>
                    
                </div>
              </div>
            <div class="time-slider"></div>
              <div class="scroll-box mt-2">
                <div class="flight-info">
                <div class="fw-bold d-flex align-items-center gap-2">
                  <img src="assets/image/group.jpg" alt="" style="width: 30px; height: 30px" />
                  <div class="flight-header">
                 <h5>THÔNG TIN CHUYẾN ĐI</h5>
                  </div>
                  </div>

                      <div class="flight-schedule">
                        <div class="flight-departure">
                            <h5>Ngày đi - {{ stateData?.scheduleStartDate | date:'dd/MM/yyyy' }}</h5>
                          <div class="time">
                            <span class="time-value">12:00</span>
                            <div class="time-slider"></div>
                            <span class="time-value">14:10</span>
                          </div>
                        </div>

                        <div class="flight-return">
                          <h5>Ngày về - {{stateData?.scheduleEndDate | date:'dd/MM/yyyy'}}</h5>
                          <div class="time">
                            <span class="time-value">20:30</span>
                            <div class="time-slider"></div>
                            <span class="time-value">22:40</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                <div class="fw-bold d-flex align-items-center gap-2">
                  <img src="assets/image/group.jpg" alt="" style="width: 30px; height: 30px" />
                  <div class="flight-header kh"><h5>KHÁCH HÀNG + PHỤ THU</h5></div>
                </div>
                <!-- <div class="mt-3" id="customerSummary">
                  <div class="fw-bold d-flex align-items-center gap-2">
                    <img src="images/group.jpg" alt="" style="width: 30px; height: 30px" />
                    <div class="fs-5">KHÁCH HÀNG + PHỤ THU</div>
                  </div>
                  <div id="summaryLines"></div>
                  <div class="line-item">
                    <span>Người lớn</span>
                    <span>1 x 11.990.000 ₫</span>
                  </div>
                  <div class="line-item">
                    <span>Trẻ em</span>
                    <span>1 x 11.990.000 ₫</span>
                  </div>
                  <div class="line-item">
                    <span>Phụ thu phòng đơn</span>
                    <span>2.200.000 ₫</span>
                  </div>
                  <div class="line-item">
                    <strong>Tổng</strong>
                    <strong class="text-danger" id="totalAmount">0 ₫</strong>
                  </div>
                </div> -->

                <div class="mt-3" id="customerSummary">
                  <div id="summaryLines"></div>
                </div>

               <div class="mt-4">
                <div *ngFor="let item of summaryList" class="line-item">
                  <span *ngIf="item.count > 0">{{ item.label }}</span>
                  <span *ngIf="item.count > 0">{{ item.count }} x {{ item.price | number }} ₫</span>
                </div>
              </div>

              </div>
              <div class="line-item mt-4 border-top pt-3">
                <strong class="fs-3">Tổng tiền</strong>
                <strong class="price fs-3">{{totalAmount  | number:'1.0-0'}} ₫</strong>
              </div>
             <button class="btn-dattour" [disabled]="!contactForm.valid" (click)="placeOrder()">Đặt tour</button>
            <!-- Thêm phần form thanh toán ở giữa màn hình khi nhấn đặt tour -->
                    <div *ngIf="showPaymentForm" class="payment-form-container">
            <form (ngSubmit)="onSubmit()">
              <div>
                <div>
                  <!-- Dấu "X" để đóng form -->
                  <span class="close-btn" (click)="closePaymentForm()">&#10006;</span>

                  <div class="fw-bold2">LỰA CHỌN PHƯƠNG THỨC THANH TOÁN</div>

                  <!-- Hiển thị các phương thức thanh toán -->
                  <div class="payment-methods">
                    <div *ngFor="let method of paymentMethods" class="payment-option" (click)="selectPaymentMethod(method.name)">
                      <img [src]="method.imageUrl" alt="{{ method.name }}" class="payment-icon" />
                      <span>{{ method.description }}</span>
                      <!-- Dấu tích khi phương thức được chọn -->
                      <span *ngIf="selectedPaymentMethod === method.name" class="check-icon">&#10004;</span>
                    </div>
                  </div>

                  <div class="mt-4">
                    <button  [disabled]="!contactForm.valid" (click)="placeOrder2()" type="submit" class="btn btn-primary w-100" [disabled]="!selectedPaymentMethod">
                      Thanh toán ngay
                    </button>
                  </div>
                </div>
              </div>
            </form>
          </div>


              </div>
            </div>
          </div>
        </div>
      </div>